{extend name="layout"/} {block name="warp"}
<div class="container">
    <div class="row">
        <form action="" id="cat" class="w-50">
            <div class="form-group">
                <input type="hidden" name="id" value="{$data.id}">
                <label for="cname">名称(汉)</label>
                <input type="text" class="form-control" name="cname" value="{$data.cname}">
            </div>
            <div class="form-group">
                <label for="path">路径名称</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="path" value="{$data.path}">
                    <span class="input-group-append">
                        <a href="{:url('unity_getpinyin')}" class="btn btn-dark" id="pinyin">拼音</a>
                    </span>
                </div>
            </div>
            {if !$parent}
            <div class="form-group">
                <label for="type">所属模型<code>*</code></label>
                <select name="type" class="form-control">
                    <option value="1">文章</option>
                    <option value="2">产品</option>
                </select>
                <small class="text-muted">为此栏目选择所使用的模型，一旦确定不可更改。<br>若与上级栏目的模型不一致，将以上级栏目所用模型为准，顶级栏目除外。</small>
            </div>{/if}
            <div class="form-group">
                <label for="parent">上级栏目</label>
                <select name="parent" id="parent" class="form-control">
                    <option value="0">顶级</option>
                    {foreach $list as $item}
                    <option value="{$item.id}" {if $item.id==$parent.id}selected{/if}>{$item.cname}</option>
                    {/foreach}
                </select>
            </div>
            <div class="form-group">
                {if $data.id}
                <a href="{:url('_category_update')}" class="btn btn-dark" id="send">更新</a>
                {else/}
                <a href="{:url('_category_save')}" class="btn btn-dark" id="send">保存</a>
                {/if}
            </div>

        </form>
    </div>
</div>
{/block} {block name="warpJS"}
<script>
    // 取拼音
    document.querySelector('a#pinyin').addEventListener('click', function (event) {
        event.preventDefault();
        var words = document.querySelector('input[name=cname]').value;
        $.post(event.target.href, { words: words }, function (resp) {
            if (resp) { document.querySelector('input[name=path]').value = resp }
        })
    })
    // 新增与更新
    document.querySelector('a#send').addEventListener('click', function (event) {
        event.preventDefault();
        var data = jQuery('form#cat').serialize();
        ajax(event.target.href, data);
    })
</script> {/block}