{extend name="layout"/} {block name="warp"}
<div class="container">
    <div class="row">
        <div class="w-100">
            <form action="" id="article">
                <div class="form-group">
                    {:token()}
                    <input type="hidden" name="id" value="{$data.id}">
                    <label for="title">文章标题</label>
                    <input type="text" name="title" class="form-control" value="{$data.title}">
                </div>
                <div class="form-group">
                    <label for="category">所属分类</label>
                    <select class="form-control" id="category">
                        {foreach $categorys as $cat}
                        <option value="{$cat.id}" {if $data.category_id == $cat.id}selected{/if}>{$cat.cname}</option>
                        {/foreach}
                    </select>
                </div>
                <div class="form-group">
                    <label for="title">文章内容</label>
                    <textarea class="form-control" id="edit">{$data.content}</textarea>
                </div>
                <div class="form-group">
                    <label for="keywords">页面关键词</label>
                    <input type="text" class="form-control" value="{$data.keywords}">
                </div>
                <div class="form-group">
                    <label for="description">页面描述</label>
                    <textarea name="description" class="form-control">{$data.description}</textarea>
                </div>

                <div class="form-group">
                    {if $data.id}
                    <a href="{:url('_article_update')}" class="btn btn-sm btn-outline-dark rounded-0" id="send">更新</a>
                    {else/}
                    <a href="{:url('_article_save')}" class="btn btn-sm btn-outline-dark rounded-0" id="send">保存</a>
                    {/if}
                </div>
            </form>
        </div>
    </div>
</div> {/block} {block name="warpJS"}
<script src="/static/tinymce/tinymce.min.js"></script>
<script>
    tinymce.init({
        selector: 'textarea#edit',
        height: 300,
        menubar: false,
        plugins: [
            'advlist autolink lists link image charmap print preview anchor textcolor',
            'searchreplace visualblocks code fullscreen',
            'insertdatetime media table contextmenu paste code help wordcount'
        ],
        toolbar: 'insert | code | undo redo |  formatselect | bold italic backcolor  | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
        language: 'zh_CN',
        relative_urls: false,
        image_dimensions: false,
        images_upload_url: '{:url("_unity_upimg")}',
    });
    document.querySelector('form#article a#send').addEventListener('click', function (event) {
        event.preventDefault();
        var data = jQuery('form#article').serializeArray();
        data.push({name:'content',value: tinymce.get('edit').getContent()});
        data.push({name:'content_text',value: tinymce.get('edit').getContent({format:'text'})});
        document.querySelector('form#article').querySelector('select').querySelectorAll('option').forEach(function(k){
            if(k.selected){data.push({name:'category_id',value:k.value});return;}
        })
        ajax(event.target.href, data);
    })
</script> {/block}